# Bookstore
## Тестовое задание для "Positron - Студия Грохотова"

### Технологии

Python 3.10, Django 4.2, Django REST Framework 3.14, DRF-YASG 1.21

### Запуск проекта локально

Склонируйте репозиторий:

```
git clone git@github.com:tanja-ovc/grokhotov-book-store.git
```

либо

```
git clone https://github.com/tanja-ovc/grokhotov-book-store.git
```

Создайте файл с названием ```.env``` в корневой директории ```/grokhotov-book-store``` (там же, где ```.env.example```) и заполните его данными из файла ```.env.example```.

При необходимости установите Docker Desktop для вашей операционной системы (https://www.docker.com/products/docker-desktop/) и запустите его.

Убедитесь, что вы в директории с файлом ```docker-compose.yaml```, и оттуда выполните команду:

```
docker-compose up -d
```

Для пересборки образа (в случае обновления кода) дополните команду так:

```
docker-compose up -d --build
```

Примените миграции:

```
docker-compose exec web python manage.py migrate
```

Соберите статику:

```
docker-compose exec web python manage.py collectstatic --no-input
```

По желанию создайте суперюзера:

```
docker-compose exec web python manage.py createsuperuser
```

Для остановки работы контейнеров используйте:

```
docker-compose stop
```

### Аутентификация

В проекте настроена аутентификация как на основе сессий, так и на основе токена.

Имея логин и пароль, введённые при создании суперюзера, вы можете получить токен для аутентификации.

### Загрузка данных в БД

Командой ниже вы можете заполнить базу данных информацией из приложенного к тестовому заданию файла ```books.json```:

```
docker-compose exec web python manage.py runscript populate_db_with_file_data
```

Файл запрашивается через API Gitlab. Исполняемый по команде выше скрипт обрабатывает полученные данные и сохраняет в БД в соответствии со структурой её таблиц.

Если вызвать команду повторно, второй раз данные записаны не будут (только если в исходном файле появятся новые данные о книгах).

<img width="935" alt="Screenshot 2024-04-04 at 18 53 56" src="https://github.com/tanja-ovc/grokhotov-book-store/assets/85249138/631dc71a-7c2c-4747-bf57-b48bb6b5a573">

В проекте в директории ```media/books_images/``` сохраняются изображения книг (thumbnails), загружаемые по ссылкам из исходного файла во время работы скрипта.

<img width="495" alt="Screenshot 2024-04-05 at 00 07 21" src="https://github.com/tanja-ovc/grokhotov-book-store/assets/85249138/71aaef1b-1531-451d-af1c-15e5d75a66a9">

Если в информации о книге не было передано никакой категории, к которой эта книга относится, то книга записывается в категорию новинок "New".

Какое предусмотрено обращение с данными с ошибками:

1) Если имена авторов или названия категорий - пустые строки, они не сохраняются в БД.
2) Если количество страниц равно 0, это расценивается как отсуствие данных и поле "кол-во страниц" для книги оставляется пустым.
3) Для поля ISBN и поля ссылки на картинку *не* проставлена уникальность (unique constraints в БД): это сделано для того, чтобы можно было сохранить все данные без потерь, несмотря на их ошибочность. Предполагается дальнейшее редактирование таких данных вручную.

### API

Спецификация с возможностью отправки запросов доступна после старта контейнеров по http://localhost/swagger/

Реализованы эндпоинты для
- получения списка всех книг с возможностью их фильтрации по определенной категории (по id и названию), а также по названию, автору, статусу и дате выпуска,

<img width="659" alt="Screenshot 2024-04-03 at 23 48 52" src="https://github.com/tanja-ovc/grokhotov-book-store/assets/85249138/7ee56996-ec72-42ce-9df6-54c83baf84df">

- получения списка категорий с их подкатегориями,
- получения конкретной книги (в ответе приходит не только информация о запрошенной книге, но и список из 5 книг, которые находятся в той же категории).

Все списки пагинируются по умолчанию.

### Админка

В проекте настроена админка, для входа в неё используйте логин + пароль ранее созданного суперюзера.

### Форма обратной связи

По адресу http://localhost/feedback/ находится форма обратной связи. Данные из неё после отправки сохраняются в БД.
